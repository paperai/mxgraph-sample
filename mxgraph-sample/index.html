<!--
Copyright (c) 2006-2013, JGraph Ltd

Windows example for mxGraph. This example demonstrates using
the mxWindow class for displaying windows.

元にしたソース: mxgraph\javascript\examples\windows.html
-->
<html>
<head>
<title>mxGraph sample for FlowGraph</title>

<style>
  label {
    font-size: 14px;
  }
  .short {
    width: 32px;
  }
</style>

<!-- Sets the basepath for the library if not in same directory -->
<script type="text/javascript">
  mxBasePath = './'
  let mxLoadResources = false
</script>

<!-- Loads and initializes the library -->
<script type="text/javascript" src="mxClient.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Example code -->
<script type="text/javascript">

  // windowの左上コーナーの位置と幅、高さ
  const WINDOW_X = 50
  const WINDOW_Y = 50
  const WINDOW_WIDTH = 1200
  const WINDOW_HEIGHT = 600

  // ノードの幅と高さ
  const CELL_WIDTH = 80
  const CELL_HEIGHT = 30

  // 定義しているカラー数
  const COLOR_MAX = 4

  // カラースタイル
  const colorStyles = {
    color1: {
      [mxConstants.STYLE_STROKECOLOR]: 'black',
      [mxConstants.STYLE_FONTCOLOR]: 'black',
      [mxConstants.STYLE_FILLCOLOR]: '#e5c095'
    },
    color2: {
      [mxConstants.STYLE_STROKECOLOR]: 'black',
      [mxConstants.STYLE_FONTCOLOR]: 'black',
      [mxConstants.STYLE_FILLCOLOR]: '#d37a9b'
    },
    color3: {
      [mxConstants.STYLE_STROKECOLOR]: 'black',
      [mxConstants.STYLE_FONTCOLOR]: 'black',
      [mxConstants.STYLE_FILLCOLOR]: '#b3efbb'
    },
    color4: {
      [mxConstants.STYLE_STROKECOLOR]: 'black',
      [mxConstants.STYLE_FONTCOLOR]: 'black',
      [mxConstants.STYLE_FILLCOLOR]: '#8edee2'
    }
  }

  const annotations = {span: {}, relation: {}}

  function randomInt (max) {
    return Math.floor(Math.random() * Math.floor(max))
  }

  // Program starts here. Creates a sample graph in the
  // DOM node with the specified ID. This function is invoked
  // from the onLoad event handler of the document (see below).
  function main (container) {
    // Checks if the browser is supported
    if (!mxClient.isBrowserSupported()) {
      // Displays an error message if the browser is not supported.
      mxUtils.error('Browser is not supported!', 200, false)
    } else {
      // Note that we're using the container scrollbars for the graph so that the
      // container extends to the parent div inside the window
      var wnd = new mxWindow('mxGraph sample program', container, WINDOW_X, WINDOW_Y, WINDOW_WIDTH, WINDOW_HEIGHT, true, true)

      // Creates the graph inside the given container
      var graph = new mxGraph(container)

      // Adds rubberband selection and keystrokes

      graph.setTooltips(true)

      graph.setPanning(true)

      // セルのラベルの編集を禁止する
      graph.setCellsEditable(false)

      // カラースタイルを設定
      Object.keys(colorStyles).forEach(key => {
        graph.getStylesheet().putCellStyle(key, colorStyles[key])
      })

      var rubberband = new mxRubberband(graph)
      new mxKeyHandler(graph)

      mxEvent.disableContextMenu(container)

      // Gets the default parent for inserting new cells. This
      // is normally the first child of the root (ie. layer 0).
      var parent = graph.getDefaultParent()

/*
      graph.getModel().beginUpdate();
      try {
        var v1 = graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30);
        var v2 = graph.insertVertex(parent, null, 'World!', 200, 150, 80, 30);
        var e1 = graph.insertEdge(parent, null, '', v1, v2);
      } finally {
        // Updates the display
        graph.getModel().endUpdate();
      }
*/

      wnd.setMaximizable(true)
      wnd.setResizable(true)
      wnd.setVisible(true)

      // var lorem = 'Lorem ipsum dolor sit amet, consectetur adipisici elit, sed eiusmod tempor incidunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquid ex ea commodi consequat. Quis aute iure reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint obcaecat cupiditat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. ';
      // var content = document.createElement('div');
      // mxUtils.write(content, lorem + lorem + lorem);

      // mxLog.show()

      $('#add-span').click(() => {
        graph.getModel().beginUpdate()
        try {
          const id = $('#span-id').val()
          const label = $('#span-label').val() + '\n' + $('#span-text').val()
          const color = Object.keys(colorStyles)[randomInt(COLOR_MAX)]
          annotations.span[id] = graph.insertVertex(parent, null, label, 0, 0, CELL_WIDTH, CELL_HEIGHT, color)
        } finally {
          graph.getModel().endUpdate()
        }



	  // var v1 = graph.insertVertex(parent, null, value, 100, 60, 120, 80, 'overflow=fill;');

      })
      $('#add-rel').click(() => {
        // $('#rel-head')
        // $('#rel-tail')
        // $('#rel-label')
      })
    }
  }
</script>
</head>

<!-- Page passes the container for the graph to the program -->

<body onload="main(document.getElementById('graphContainer'))">
  <label for='spanId'>Id:</label><input type='text' id='span-id' class='short'>
  <label for='spanLabel'>Label:</label><input type='text' id='span-label'>
  <label for='spanText'>Text:</label><input type='text' id='span-text'>
  <button id='add-span'>add span</button>
  <label for='relHead'>Head:</label><input type='text' id='rel-head' class='short'>
  <label for='relTail'>Tail:</label><input type='text' id='rel-tail' class='short'>
  <label for='relLabel'>Label:</label><input type='text' id='rel-label'>
  <button id='add-rel'>add relation</button>

  <!-- Creates a container for the graph with a grid wallpaper -->
  <div id="graphContainer" style="overflow:auto;position:absolute;width:100%;height:100%;background:lightyellow;cursor:default;">
  </div>
</body>

</html>